<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Geography Game with Country Highlight, Confetti, and Flags</title>
    <!-- Link to Google Fonts for Pacifico font -->
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <!-- Include the Canvas Confetti library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* ... (Your existing CSS styles) ... */
    </style>
</head>
<body>
    <!-- ... (Your existing HTML content) ... -->

    <script>
        const countryData = [];
        const continents = ["Africa", "Asia", "Europe", "North America", "South America", "Australia", "Antarctica"];
        const regionMapping = {
            'Africa': 'Africa',
            'Americas': '', // Will handle North and South America separately
            'Antarctic': 'Antarctica',
            'Asia': 'Asia',
            'Europe': 'Europe',
            'Oceania': 'Australia'
        };
        const subregionMapping = {
            'Northern America': 'North America',
            'Latin America': 'South America',
            'Caribbean': 'North America',
            'Central America': 'North America',
            'South America': 'South America'
        };
        const countryDisplay = document.getElementById("country");
        const countryFlag = document.getElementById("country-flag");
        const resultDisplay = document.getElementById("result");
        const continentButtonsContainer = document.getElementById("continent-buttons");
        const splashScreen = document.getElementById("splash-screen");
        const startButton = document.getElementById("start-button");
        const gameContainer = document.getElementById("game-container");

        let currentCountry = {};
        let map;
        let countryLayer;

        startButton.addEventListener('click', () => {
            splashScreen.style.display = 'none';
            gameContainer.style.display = 'block';
            initMap();
        });

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 2,
                center: { lat: 20, lng: 0 },
                gestureHandling: 'auto',
                zoomControl: true,
            });
            countryLayer = new google.maps.Data();
            countryLayer.setMap(map);
            createButtons();
            loadCountryData();
        }

        function loadCountryData() {
            // Fetch country data from the REST Countries API
            fetch('https://restcountries.com/v3.1/all')
                .then(response => response.json())
                .then(data => {
                    data.forEach(country => {
                        if (country.name && country.name.common && country.region && country.cca3 && country.flags) {
                            let continent = regionMapping[country.region];
                            if (continent === '') {
                                // Handle Americas regions
                                continent = subregionMapping[country.subregion] || 'North America';
                            }

                            countryData.push({
                                country: country.name.common,
                                continent: continent,
                                flagUrl: country.flags.svg || country.flags.png,
                                code: country.cca3.toUpperCase()
                            });
                        }
                    });

                    // Load custom.geo.json file containing all countries
                    fetch('custom.geo.json')
                        .then(response => response.json())
                        .then(geojsonData => {
                            countryLayer.addGeoJson(geojsonData);
                            startGame();
                        })
                        .catch(error => {
                            console.error('Error loading custom.geo.json:', error);
                            alert('Failed to load map data.');
                        });
                })
                .catch(error => {
                    console.error('Error fetching country data:', error);
                    alert('Failed to load country data.');
                });
        }

        function startGame() {
            resultDisplay.innerText = "";
            clearCountryHighlight();
            resetButtons();

            currentCountry = countryData[Math.floor(Math.random() * countryData.length)];
            countryDisplay.innerText = `Which continent is ${currentCountry.country} in?`;
            countryFlag.src = currentCountry.flagUrl;
            countryFlag.alt = `${currentCountry.country} Flag`;
        }

        function checkAnswer(selectedContinent, button) {
            if (selectedContinent === currentCountry.continent) {
                resultDisplay.innerText = "Correct!";
                resultDisplay.style.color = "green";
                disableAllButtons();
                button.classList.add('correct');
                playConfetti();
                highlightCountry(currentCountry.code);
                setTimeout(startGame, 3000);
            } else {
                resultDisplay.innerText = "Try again.";
                resultDisplay.style.color = "red";
                button.classList.add('incorrect');
                button.disabled = true;
            }
        }

        function createButtons() {
            continentButtonsContainer.innerHTML = '';
            continents.forEach(continent => {
                const button = document.createElement("button");
                button.classList.add("continent-button");
                button.innerText = continent;
                button.onclick = () => checkAnswer(continent, button);
                continentButtonsContainer.appendChild(button);
            });
        }

        function resetButtons() {
            const buttons = document.querySelectorAll('.continent-button');
            buttons.forEach(button => {
                button.disabled = false;
                button.classList.remove('incorrect', 'correct');
            });
        }

        function disableAllButtons() {
            const buttons = document.querySelectorAll('.continent-button');
            buttons.forEach(button => {
                button.disabled = true;
            });
        }

        function highlightCountry(countryCode) {
            // Reset styles
            countryLayer.setStyle({
                fillColor: 'gray',
                strokeColor: 'black',
                strokeWeight: 1,
                fillOpacity: 0.5
            });

            // Set style for the selected country
            countryLayer.setStyle(function(feature) {
                const featureCode = feature.getProperty('ADM0_A3') || feature.getProperty('ISO_A3') || feature.getProperty('ISO3');
                if (featureCode && featureCode.toUpperCase() === countryCode.toUpperCase()) {
                    return {
                        fillColor: 'yellow',
                        strokeColor: 'black',
                        strokeWeight: 1,
                        fillOpacity: 0.8
                    };
                } else {
                    return {
                        fillColor: 'gray',
                        strokeColor: 'black',
                        strokeWeight: 1,
                        fillOpacity: 0.5
                    };
                }
            });
        }

        function clearCountryHighlight() {
            countryLayer.setStyle({
                fillColor: 'gray',
                strokeColor: 'black',
                strokeWeight: 1,
                fillOpacity: 0.5
            });
        }

        function playConfetti() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }
    </script>
    <!-- Google Maps API script -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBZuMlB4pHfR5sLCxFNQ1xKbc01wTdJcNY&callback=initMap"></script>
</body>
</html>
